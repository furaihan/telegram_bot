:local send [:parse [/system script get tg_sendMessage source]]
:local tolower [:parse [/system script get func_lowercase source]]
:local param1 [:pick $params 0 [:find $params " "]]
:local param2 [:pick $params ([:find $params " "]+1) [:len $params]]
:local param3 [:pick [:pick $params ([:find $params " "]+1) [:len $params]] ([:find [:pick $params ([:find $params " "]+1) [:len $params]] " "]+1) [:len [:pick $params ([:find $params " "]+1) [:len $params]]]]
:if ([:len [:find $param2 " "]]>0) do={
	:set param2 [:pick [:pick $params ([:find $params " "]+1) [:len $params]] 0 [:find [:pick $params ([:find $params " "]+1) [:len $params]] " "]]
} else={
	:set param3 ""
}

:local paramsLower [$tolower $params];
:local param1Lower [$tolower $param1];
:local param2Lower [$tolower $param2];
:local param3Lower [$tolower $param3]

if ($paramsLower = "help") do={
	local hotspothelp
	set hotspothelp ("*Daftar parameter yang valid:*%0A%0A")
	set hotspothelp ($hotspothelp.">  /hotspot session help - menampilkan deskripsi dari parameter session%0A")
	set hotspothelp ($hotspothelp.">  session showall - Menampilkan seluruh detail user yang sedang aktif mulai dari Username sampai Uptime (kecuali password). %0AContoh: _/hotspot session showall_%0A")
	set hotspothelp ($hotspothelp.">  session deauth-by-user _<username>_ - Mencabut session perangkat berdasarkan Username. %0AContoh: _/hotspot session deauth-by-user telecomadmin_%0A")
	set hotspothelp ($hotspothelp.">  session deauth-by-ip _<ip>_ - Mencabut session perangkat berdasarkan Alamat IP. %0AContoh: _/hotspot session deauth-by-ip 192.168.1.1_%0A")
	set hotspothelp ($hotspothelp.">  session deauth-by-mac _<ip>_ - Mencabut session perangkat berdasarkan Alamat MAC. %0AContoh: _/hotspot session deauth-by-mac AB:CD:EF:01:23:45_%0A")
	set $hotspothelp ($hotspothelp.">  add _<user> <password>_ - Menambah user baru. %0AContoh: _/hotspot add telecomadmin admintelecom_%0A")
	set hotspothelp ($hotspothelp.">  delete _<user>_ - Menghapus user. %0AContoh: _/hotspot delete telecomadmin _%0A")
	set hotspothelp ($hotspothelp.">  disable _<user>_ - menonaktifkan user. %0AContoh: _/hotspot disable telecomadmin _%0A")
	set hotspothelp ($hotspothelp.">  enable _<user>_ - mengaktifkan user. %0AContoh: _/hotspot enable telecomadmin _%0A")
	set hotspothelp ($hotspothelp.">  change-password _<user> <new-pass>_ - mengganti password user. %0AContoh: _/hotspot change-password telecomadmin  p4sSw_%0A%0A")
	$send chat=$chatid text=("$hotspothelp") mode="Markdown"
}

:if ($param1Lower="session") do={
	:if ($param2Lower="help") do={
		local sessionhelp
		set sessionhelp ("*Daftar parameter yang valid:*%0A%0A")
		set sessionhelp ($sessionhelp.">  showall - Menampilkan seluruh detail user yang sedang aktif mulai dari Username sampai Uptime (kecuali password). %0AContoh: _/hotspot session showall_%0A")
		set sessionhelp ($sessionhelp.">  deauth-by-user _<username>_ - Mencabut session perangkat berdasarkan Username. %0AContoh: _/hotspot session deauth-by-user telecomadmin_%0A")
		set sessionhelp ($sessionhelp.">  deauth-by-ip _<ip>_ - Mencabut session perangkat berdasarkan Alamat IP. %0AContoh: _/hotspot session deauth-by-ip 192.168.1.1_%0A")
		set sessionhelp ($sessionhelp.">  deauth-by-mac _<ip>_ - Mencabut session perangkat berdasarkan Alamat MAC. %0AContoh: _/hotspot session deauth-by-mac AB:CD:EF:01:23:45_%0A")
		$send chat=$chatid text=("$sessionhelp") mode="Markdown"
	}
	:if ($param2Lower="count") do={
		:local output
		:local hotspot [:len [/ip hotspot active find]]
		:local text "Router ID:* $[/system identity get name] * %0A\
		Hotspot users: _$hotspot online_"
		$send chat=$chatid text=$text mode="Markdown"
	}
	:if ($param2Lower="showall") do={
		:local output
		:foreach activeIndex in=[/ip hotspot active find] do={
			:local activeUser ("*Username*: ".[/ip hotspot active get value-name="user" $activeIndex]."%0A")
			:local activeAddress ("*IP*: ".[/ip hotspot active get value-name="address" $activeIndex]."%0A")
			:local activeMACAddr ("*MAC*: ".[/ip hotspot active get value-name="mac-address" $activeIndex]."%0A")
			:local activeLoginBy ("*Login Method*: ".[/ip hotspot active get value-name="login-by" $activeIndex]."%0A")
			:local activeUptime ("*Uptime*: ".[/ip hotspot active get value-name="uptime" $activeIndex]."%0A")
			:local idletime ("*Idle Time*: ".[/ip hotspot active get value-name="idle-time" $activeIndex]."%0A")
			:local serverIn ("*Server*: ".[/ip hotspot active get value-name="server" $activeIndex]."%0A")
			:set output ($output.$activeUser.$activeAddress.$activeMACAddr.$activeUptime.$idletime.$activeLoginBy.$serverIn."%0A")
		}
		$send chat=$chatid text=("$output") mode="Markdown"
	}
	:if ($param2Lower="deauth-by-user") do={
		/ip hotspot active remove [find user="$param3"]
		$send chat=$chatid text=("Sesi User $param3 berhasil dihapus") mode="Markdown"
	}
	:if ($param2Lower="deauth-by-mac") do={
		/ip hotspot active remove [find mac-address="$param3"]
		$send chat=$chatid text=("Sesi MAC $param3 berhasil dihapus") mode="Markdown"
	}
	:if ($param2Lower="deauth-by-ip") do={
		/ip hotspot active remove [find address="$param3"]
		$send chat=$chatid text=("Sesi IP $param3 berhasil dihapus") mode="Markdown"
	}
}
:if ($param1Lower="add") do={
	/ip hotspot user add name=$param2 password=$param3 profile=default
	$send chat=$chatid text=("Berhasil membuat user baru. Masuk ke hotspot dengan:%0A%0A*Username:* $param2%0A*Password:* $param3") mode="Markdown"
}
:if ($param1Lower="delete") do={
	if ([:len [ip hotspot user find where name=$param2]] > 0) do={
		/ip hotspot user remove [find name=$param2]
		$send chat=$chatid text=("Berhasil menghapus user $param2.") mode="Markdown"
	} else={
		$send chat=$chatid text=("User $param2 tidak ditemukan") mode="Markdown"
	}
}
:if ($param1Lower="disable") do={
	if ([:len [ip hotspot user find where name=$param2]] > 0) do={
		/ip hotspot user disable [find name=$param2]
		$send chat=$chatid text=("$param2 kini telah dinonaktifkan") mode="Markdown"
	} else={
		$send chat=$chatid text=("User $param2 tidak ditemukan") mode="Markdown"
	}
}
:if ($param1Lower="enable") do={
	if ([:len [ip hotspot user find where name=$param2]] > 0) do={
	/ip hotspot user enable [find name=$param2]
	$send chat=$chatid text=("$param2 kini telah diaktifkan") mode="Markdown"
	} else={
		$send chat=$chatid text=("User $param2 tidak ditemukan") mode="Markdown"
	}
}
:if ($param1Lower="setprofile") do={
	if ([:len [ip hotspot user find where name=$param2]] > 0) do={
		/ip hotspot user set password=$param3 [find name=$param2]
		/ip hotspot active remove [find name=$param2]
		$send chat=$chatid text=("Berhasil mengganti profile menjadi $param3.") mode="Markdown"
	} else={
		$send chat=$chatid text=("User $param2 tidak ditemukan") mode="Markdown"
	}
}
:if ($param1Lower="change-password") do={
	if ([:len [ip hotspot user find where name=$param2]] > 0) do={
		/ip hotspot user set password=$param3 [find name=$param2]
		/ip hotspot active remove [find name=$param2]
		$send chat=$chatid text=("Berhasil mengganti password untuk $param2.") mode="Markdown"
	} else={
		$send chat=$chatid text=("User $param2 tidak ditemukan") mode="Markdown"
	}
}
:if (($param1Lower = "user") and ($param2Lower = "list")) do={
	local listusertext ("*Daftar user hotspot*%0A%0A")
	local numberuser (0)
	foreach pengguna in=[/ip hotspot user find name!=default-trial] do={
		set numberuser ($numberuser + 1)
		set listusertext ($listusertext."Number: _$numberuser_%0A")
		local usn [/ip hotspot user get value-name=name $pengguna]
		set listusertext ($listusertext."Username: _$usn_%0A")
		local hsprof [/ip hotspot user get value-name=profile $pengguna]
		set listusertext ($listusertext."Profile: _$hsprof_%0A")
		local hserv [/ip hotspot user get value-name=server $pengguna]
		set listusertext ($listusertext."Server: _$hserv_%0A")
		local isactive
		if ([:len [/ip hotspot active find user=$pengguna]] > 0) do={ set isactive true} else={ set isactive false}
		set listusertext ($listusertext."Active: _$isactive_%0A%0A")
	}
	set listusertext ($listusertext."*END REPORT*")
	$send chat=$chatid text=("$listusertext") mode="Markdown"
}
